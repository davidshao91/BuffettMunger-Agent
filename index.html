<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuffettMunger-Agent - æ•°å­—åŒ–ä»·å€¼æŠ•èµ„æ™ºèƒ½ä½“</title>
    <link rel="stylesheet" href="style.css">
    <!-- å¼•å…¥Chart.jsåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <!-- å¼•å…¥å¯¼å‡ºåŠŸèƒ½æ‰€éœ€çš„åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- å¼•å…¥Markdownè§£æåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.0.1/marked.min.js"></script>
    <!-- å¼•å…¥Markdownæ ·å¼ -->
    <style>
      #markdownContent h1 {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
        color: #111827;
      }
      #markdownContent h2 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: #111827;
      }
      #markdownContent h3 {
        font-size: 1.25rem;
        font-weight: bold;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        color: #111827;
      }
      #markdownContent p {
        margin-bottom: 1rem;
        line-height: 1.6;
      }
      #markdownContent ul, #markdownContent ol {
        margin-bottom: 1rem;
        margin-left: 2rem;
      }
      #markdownContent li {
        margin-bottom: 0.5rem;
      }
      #markdownContent table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1.5rem;
      }
      #markdownContent th, #markdownContent td {
        padding: 0.75rem;
        text-align: left;
        border: 1px solid #e5e7eb;
      }
      #markdownContent th {
        background-color: #f3f4f6;
        font-weight: bold;
      }
      #markdownContent code {
        background-color: #f3f4f6;
        padding: 0.2rem 0.4rem;
        border-radius: 0.25rem;
        font-family: monospace;
      }
      #markdownContent pre {
        background-color: #f3f4f6;
        padding: 1rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin-bottom: 1rem;
      }
      #markdownContent pre code {
        background-color: transparent;
        padding: 0;
      }
      #markdownContent blockquote {
        border-left: 4px solid #e5e7eb;
        padding-left: 1rem;
        margin-bottom: 1rem;
        color: #6b7280;
      }
    </style>
  </head>
<body>

  <div class="container">
    <header>
      <h1>BuffettMunger-Agent</h1>
      <p class="sub">ä»·å€¼æŠ•èµ„åˆ†ææ™ºèƒ½ä½“ Â· å®‰å…¨è¾¹é™… Â· æŠ¤åŸæ²³ Â· é£é™©ç­›æŸ¥ Â· é€æ˜å¯éªŒè¯</p>
      <a href="https://github.com/davidshao91/BuffettMunger-Agent" target="_blank" class="star-btn">â­ Star é¡¹ç›®</a>
    </header>

    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <div class="tab-navigation" style="margin: 2rem 0;">
      <button class="tab-btn" data-tab="fire">ğŸ”¥ FIREè®¡ç®—å™¨</button>
      <button class="tab-btn active" data-tab="holdings">ğŸ“‹ æˆ‘çš„æŒä»“</button>
      <button class="tab-btn" data-tab="analysis">ğŸ§ª è‚¡ç¥¨åˆ†æ</button>
      <button class="tab-btn" data-tab="recommendations">ğŸ’ å¥½å…¬å¸æ¨è</button>
      <button class="tab-btn" data-tab="ai-agent">ğŸ¤– AIæ™ºèƒ½ä½“å¯¹è¯</button>
    </div>

    <!-- æŒä»“ç®¡ç†æ¨¡å— -->
    <div class="tab-content active" id="holdings-tab">
      <div class="demo-box">
        <h2>ğŸ“‹ æˆ‘çš„æŒä»“</h2>
        <p>ç®¡ç†æ‚¨çš„æŒä»“è‚¡ç¥¨ï¼ŒæŸ¥çœ‹å®‰å…¨è¾¹é™…åˆ†æ</p>
        
        <div class="form-group">
          <button id="addHoldingBtn">æ·»åŠ æŒä»“</button>
          <button id="analyzeHoldingsBtn">åˆ†ææŒä»“</button>
        </div>
        
        <div id="holdingsList" style="margin-top: 1rem;">
          <table id="holdingsTable" style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background-color: #f3f4f6;">
                <th style="padding: 0.5rem; text-align: left; border: 1px solid #ddd;">è‚¡ç¥¨åç§°</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">è‚¡ç¥¨ä»£ç </th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">æŒä»“æˆæœ¬</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">æŒä»“æ•°é‡</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="holdingsTableBody">
              <!-- æŒä»“æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </tbody>
          </table>
          <p id="noHoldingsMsg" style="text-align: center; color: #666; margin-top: 1rem;">æš‚æ— æŒä»“æ•°æ®ï¼Œè¯·æ·»åŠ æŒä»“</p>
        </div>
        
        <div id="holdingsAnalysis" class="result hidden" style="margin-top: 1.5rem;">
          <h3>æŒä»“åˆ†æç»“æœ</h3>
          <div class="loading">æ­£åœ¨åˆ†ææŒä»“...</div>
          <div class="report-container">
            <div class="report"></div>
            <div class="charts">
              <div class="chart-container">
                <canvas id="holdingsChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- è‚¡ç¥¨åˆ†ææ¨¡å— -->
    <div class="tab-content" id="analysis-tab">
      <div class="demo-box">
        <h2>ğŸ§ª è‚¡ç¥¨åˆ†æ</h2>
        <p>é€‰æ‹©ä¸€å®¶å…¬å¸ï¼Œè¿è¡Œå®Œæ•´ä»·å€¼æŠ•èµ„åˆ†æä½“ç³»</p>

        <div class="form-group">
          <label for="stockSelector">é€‰æ‹©è‚¡ç¥¨ï¼š</label>
          <select id="stockSelector" multiple size="5" style="width: 300px;">
            <option value="">-- é€‰æ‹©å…¬å¸ --</option>
          </select>
          <p style="font-size: 0.9rem; color: #666;">æŒ‰ä½Ctrlé”®å¯å¤šé€‰</p>
        </div>
        <div class="form-group">
          <button id="runBtn">è¿è¡Œ BuffettMunger-Agent</button>
          <button id="runPortfolioBtn">è¿è¡ŒæŠ•èµ„ç»„åˆåˆ†æ</button>
        </div>

        <div id="result" class="result hidden">
          <div class="loading">æ­£åœ¨è¿è¡Œæ™ºèƒ½ä½“åˆ†æä¸­...</div>
          
          <!-- æ™ºèƒ½ä½“å¯è§†åŒ–åŒºåŸŸ -->
          <div class="agent-visualization" style="margin-bottom: 1.5rem; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px; background-color: #f9fafb;">
            <h3>ğŸ¤– BuffettMunger-Agent åˆ†æè¿‡ç¨‹</h3>
            <div id="agentThinking" style="font-family: monospace; white-space: pre-line; line-height: 1.5;"></div>
          </div>
          
          <div class="report-container">
            <div class="report"></div>
            <div class="charts">
              <div class="chart-container">
                <canvas id="scoreChart"></canvas>
              </div>
              <div class="chart-container">
                <canvas id="metricsChart"></canvas>
              </div>
            </div>
          </div>
          <div class="export-buttons" style="margin-top: 1rem; text-align: center;">
            <button id="exportPDFBtn">å¯¼å‡º PDF</button>
            <button id="exportExcelBtn">å¯¼å‡º Excel</button>
          </div>
        </div>
      </div>
    </div>

    <!-- å¥½å…¬å¸æ¨èæ¨¡å— -->
    <div class="tab-content" id="recommendations-tab">
      <div class="demo-box">
        <h2>ğŸ’ å¥½å…¬å¸æ¨è</h2>
        <p>åŸºäºå®‰å…¨è¾¹é™…å’Œä»·å€¼æŠ•èµ„åŸåˆ™çš„å…¬å¸æ¨è</p>
        
        <div class="form-group">
          <label for="marketFilter">å¸‚åœºç­›é€‰ï¼š</label>
          <select id="marketFilter">
            <option value="">å…¨éƒ¨å¸‚åœº</option>
            <option value="CN">æ²ªæ·±è‚¡å¸‚</option>
            <option value="HK">æ¸¯è‚¡</option>
            <option value="US">ç¾è‚¡</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="filterMethod">ç­›é€‰æ–¹æ³•ï¼š</label>
          <select id="filterMethod">
            <option value="magicFormula">ç¥å¥‡å…¬å¼ (ROE/PE)</option>
            <option value="pbRoe">PB-ROEç­–ç•¥</option>
            <option value="traditional">ä¼ ç»Ÿä»·å€¼æŠ•èµ„</option>
          </select>
          <button id="refreshRecommendationsBtn">åˆ·æ–°æ¨è</button>
        </div>
        
        <div id="recommendationsList" style="margin-top: 1rem;">
          <table id="recommendationsTable" style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background-color: #f3f4f6;">
                <th style="padding: 0.5rem; text-align: left; border: 1px solid #ddd;">è‚¡ç¥¨åç§°</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">è‚¡ç¥¨ä»£ç </th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">å¸‚åœº</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">è¡Œä¸š</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">ROE(%)</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">PE</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">PB</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">PEæ’å</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">ROEæ’å</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">æ€»æ’å</th>
                <th style="padding: 0.5rem; text-align: right; border: 1px solid #ddd;">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody id="recommendationsTableBody">
              <!-- æ¨èæ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </tbody>
          </table>
          <div class="loading" id="recommendationsLoading" style="display: none; text-align: center; padding: 1rem;">æ­£åœ¨åŠ è½½æ¨è...</div>
        </div>
      </div>
    </div>

    <!-- AIæ™ºèƒ½ä½“å¯¹è¯æ¨¡å— -->
    <div class="tab-content" id="ai-agent-tab">
      <div class="demo-box">
        <h2>ğŸ¤– AIæ™ºèƒ½ä½“å¯¹è¯</h2>
        <p>ä¸ä»·å€¼æŠ•èµ„AIæ™ºèƒ½ä½“è¿›è¡Œè‡ªç„¶è¯­è¨€å¯¹è¯ï¼Œè·å–ä¸“ä¸šæŠ•èµ„åˆ†æ</p>

        <div class="form-group">
          <label for="aiStockSelector">é€‰æ‹©è‚¡ç¥¨ï¼ˆå¯é€‰ï¼‰ï¼š</label>
          <select id="aiStockSelector">
            <option value="">-- é€‰æ‹©å…¬å¸ï¼ˆå¯é€‰ï¼‰--</option>
          </select>
        </div>

        <div style="margin: 1.5rem 0;">
          <div id="chatHistory" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem; height: 400px; overflow-y: auto; background-color: #f9fafb; margin-bottom: 1rem;">
            <div class="chat-message system">
              <p>ğŸ¤– æ‚¨å¥½ï¼æˆ‘æ˜¯ä»·å€¼æŠ•èµ„AIæ™ºèƒ½ä½“ï¼ŒåŸºäºå·´è²ç‰¹å’ŒèŠ’æ ¼çš„æŠ•èµ„å“²å­¦ã€‚è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨åˆ†æçš„ï¼Ÿ</p>
            </div>
          </div>
          <div style="display: flex;">
            <input type="text" id="userInput" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šåˆ†æè´µå·èŒ…å°çš„æŠ•èµ„ä»·å€¼" style="flex: 1; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px 0 0 4px;">
            <button id="sendMessageBtn" style="padding: 0.75rem 1.5rem; background-color: #3b82f6; color: white; border: none; border-radius: 0 4px 4px 0; cursor: pointer;">å‘é€</button>
          </div>
          <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">ç¤ºä¾‹é—®é¢˜ï¼š
            <a href="#" class="example-question">åˆ†æè´µå·èŒ…å°çš„å®‰å…¨è¾¹é™…</a> | 
            <a href="#" class="example-question">äº”ç²®æ¶²çš„æŠ¤åŸæ²³åˆ†æ</a> | 
            <a href="#" class="example-question">é“¶è¡Œè‚¡çš„æŠ•èµ„æœºä¼š</a>
          </p>
        </div>

        <div id="aiAnalysisResult" class="hidden" style="margin-top: 1.5rem; padding: 1rem; border: 1px solid #e5e7eb; border-radius: 8px; background-color: #f9fafb;">
          <h3>ğŸ“Š æ·±åº¦åˆ†æç»“æœ</h3>
          <div id="analysisContent"></div>
          <div id="reasoningChain" style="margin-top: 1rem; padding: 1rem; background-color: #f3f4f6; border-radius: 6px;">
            <h4>ğŸ§  æ¨ç†è¿‡ç¨‹</h4>
            <div id="reasoningSteps"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- FIREè®¡ç®—å™¨æ¨¡å— -->
    <div class="tab-content" id="fire-tab">
      <div class="demo-box">
        <h2>ğŸ”¥ FIREè®¡ç®—å™¨</h2>
        <p>è®¡ç®—ä¸åŒå¼€å§‹å¹´é¾„å’Œå¹´åŒ–æ”¶ç›Šç‡ä¸‹çš„å®šæŠ•æ”¶ç›Šï¼Œå±•ç¤ºæŠ•èµ„å°½æ—©å¼€å§‹çš„é‡è¦æ€§</p>

        <div class="form-group">
          <label for="monthlyInvestment">æ¯æœˆå®šæŠ•é‡‘é¢ï¼ˆå…ƒï¼‰ï¼š</label>
          <input type="number" id="monthlyInvestment" value="1000" min="100" max="10000" step="100" style="width: 150px;">
        </div>

        <div class="form-group">
          <label for="investmentYears">æŠ•èµ„å¹´é™ï¼ˆå¹´ï¼‰ï¼š</label>
          <input type="number" id="investmentYears" value="30" min="10" max="50" step="5" style="width: 150px;">
        </div>

        <div class="form-group">
          <label for="displayOption">æ˜¾ç¤ºé€‰é¡¹ï¼š</label>
          <select id="displayOption" style="width: 150px;">
            <option value="finalAmount">æœ€ç»ˆèµ„äº§ï¼ˆä¸‡å…ƒï¼‰</option>
            <option value="multiple">æ”¶ç›Šå€æ•°</option>
          </select>
        </div>

        <div class="form-group">
          <button id="calculateFireBtn">è®¡ç®—æ”¶ç›Š</button>
        </div>

        <div id="fireResults" style="margin-top: 2rem;">
          <h3>æŠ•èµ„æ”¶ç›Šå¯¹æ¯”</h3>
          <div style="overflow-x: auto;">
            <table id="fireTable" style="width: 100%; border-collapse: collapse; margin-bottom: 2rem;">
              <thead id="fireTableHeader">
              <tr style="background-color: #f3f4f6;">
                <th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd; position: sticky; left: 0; background-color: #f3f4f6;">å¼€å§‹å¹´é¾„</th>
                <th style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">å¹´åŒ–æ”¶ç›Šç‡ 4%</th>
                <th style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">å¹´åŒ–æ”¶ç›Šç‡ 6%</th>
                <th style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">å¹´åŒ–æ”¶ç›Šç‡ 8%</th>
                <th style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">å¹´åŒ–æ”¶ç›Šç‡ 10%</th>
                <th style="padding: 0.75rem; text-align: center; border: 1px solid #ddd;">å¹´åŒ–æ”¶ç›Šç‡ 12%</th>
              </tr>
              <tr style="background-color: #f9fafb;">
                <th style="padding: 0.75rem; text-align: left; border: 1px solid #ddd; position: sticky; left: 0; background-color: #f9fafb;">å¹´é¾„</th>
                <th style="padding: 0.75rem; text-align: right; border: 1px solid #ddd;">æœ€ç»ˆèµ„äº§ï¼ˆä¸‡å…ƒï¼‰</th>
                <th style="padding: 0.75rem; text-align: right; border: 1px solid #ddd;">æœ€ç»ˆèµ„äº§ï¼ˆä¸‡å…ƒï¼‰</th>
                <th style="padding: 0.75rem; text-align: right; border: 1px solid #ddd;">æœ€ç»ˆèµ„äº§ï¼ˆä¸‡å…ƒï¼‰</th>
                <th style="padding: 0.75rem; text-align: right; border: 1px solid #ddd;">æœ€ç»ˆèµ„äº§ï¼ˆä¸‡å…ƒï¼‰</th>
                <th style="padding: 0.75rem; text-align: right; border: 1px solid #ddd;">æœ€ç»ˆèµ„äº§ï¼ˆä¸‡å…ƒï¼‰</th>
              </tr>
            </thead>
              <tbody id="fireTableBody">
                <!-- è®¡ç®—ç»“æœå°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
              </tbody>
            </table>
          </div>

          <div style="margin-top: 2rem;">
            <h3>æ”¶ç›Šå¯¹æ¯”å›¾è¡¨</h3>
            <div class="chart-container" style="position: relative; height: 400px; width: 100%;">
              <canvas id="fireChart"></canvas>
            </div>
          </div>
        </div>

        <div id="fireInsight" style="margin-top: 2rem; padding: 1.5rem; border: 1px solid #e5e7eb; border-radius: 8px; background-color: #f9fafb;">
          <h3>ğŸ’¡ æŠ•èµ„æ´å¯Ÿ</h3>
          <p id="insightText">ç‚¹å‡»"è®¡ç®—æ”¶ç›Š"æŒ‰é’®æŸ¥çœ‹æŠ•èµ„å°½æ—©å¼€å§‹çš„é‡è¦æ€§åˆ†æ</p>
        </div>
      </div>
    </div>

    <div class="info">
      <p>è¿™æ˜¯å¼€æºé¡¹ç›®çš„ä½“éªŒæ²™ç›’ï¼Œä½¿ç”¨ç¦»çº¿æ•°æ®æ¼”ç¤ºä»·å€¼æŠ•èµ„åˆ†ææ¡†æ¶ã€‚</p>
      <p>ä¸æ„æˆæŠ•èµ„å»ºè®®ï¼Œä¸æä¾›å®æ—¶æ•°æ®ï¼Œä¸èè‚¡ã€‚</p>
      <p><a href="VISION.md" target="_blank">é¡¹ç›®æ„¿æ™¯</a> Â· <a href="https://github.com/davidshao91/BuffettMunger-Agent" target="_blank">GitHub</a></p>
    </div>
  </div>

  <!-- æ ‡ç­¾é¡µåˆ‡æ¢è„šæœ¬ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const tabBtns = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          
          // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
          tabBtns.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          // åˆ‡æ¢å†…å®¹
          tabContents.forEach(content => {
            content.classList.remove('active');
          });
          document.getElementById(tabId + '-tab').classList.add('active');
        });
      });
    });
  </script>

  <script src="data.js"></script>
  <script src="agent.js"></script>
  
  <!-- FIREè®¡ç®—å™¨åŠŸèƒ½ -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // FIREè®¡ç®—å™¨åŠŸèƒ½
      const monthlyInvestmentInput = document.getElementById('monthlyInvestment');
      const investmentYearsInput = document.getElementById('investmentYears');
      const calculateFireBtn = document.getElementById('calculateFireBtn');
      const fireTableBody = document.getElementById('fireTableBody');
      const insightText = document.getElementById('insightText');
      let fireChart = null;
      
      // è®¡ç®—å®šæŠ•æ”¶ç›Šçš„å‡½æ•°
      function calculateInvestment(monthlyAmount, years, annualRate) {
        const months = years * 12;
        const monthlyRate = annualRate / 12;
        let totalInvestment = 0;
        let finalAmount = 0;
        
        for (let i = 0; i < months; i++) {
          totalInvestment += monthlyAmount;
          finalAmount = (finalAmount + monthlyAmount) * (1 + monthlyRate);
        }
        
        const profit = finalAmount - totalInvestment;
        const multiple = (finalAmount / totalInvestment).toFixed(2);
        
        return {
          totalInvestment: totalInvestment.toFixed(2),
          finalAmount: finalAmount.toFixed(2),
          profit: profit.toFixed(2),
          multiple: multiple
        };
      }
      
      // æ¸²æŸ“ç»“æœè¡¨æ ¼
      function renderFireTable(monthlyAmount, years) {
        fireTableBody.innerHTML = '';
        
        // ä¸åŒå¼€å§‹å¹´é¾„ï¼ˆ9ä¸ªï¼‰
        const startAges = [20, 22, 24, 26, 28, 30, 32, 34, 36];
        // ä¸åŒå¹´åŒ–æ”¶ç›Šç‡ï¼ˆ5ä¸ªï¼‰
        const annualRates = [0.04, 0.06, 0.08, 0.10, 0.12];
        // æœ€ç»ˆå¹´é¾„ï¼ˆé»˜è®¤60å²ï¼‰
        const finalAge = 60;
        // è·å–ç”¨æˆ·é€‰æ‹©çš„æ˜¾ç¤ºé€‰é¡¹
        const displayOption = document.getElementById('displayOption').value;
        
        const results = [];
        
        // æŒ‰å¹´é¾„åˆ†ç»„è®¡ç®—ç»“æœ
        for (const age of startAges) {
          // è®¡ç®—æŠ•èµ„å¹´é™ï¼ˆæœ€ç»ˆå¹´é¾„ - å¼€å§‹å¹´é¾„ï¼‰
          const actualYears = finalAge - age;
          // ç¡®ä¿æŠ•èµ„å¹´é™ä¸ºæ­£æ•°
          if (actualYears <= 0) continue;
          
          const row = document.createElement('tr');
          let rowHtml = `<td style="padding: 0.75rem; border: 1px solid #ddd; font-weight: bold; position: sticky; left: 0; background-color: white;">${age}å² (${actualYears}å¹´)</td>`;
          
          for (const rate of annualRates) {
            const result = calculateInvestment(monthlyAmount, actualYears, rate);
            // å°†æœ€ç»ˆèµ„äº§è½¬æ¢ä¸ºä¸‡å…ƒ
            const finalAmountInWan = (parseFloat(result.finalAmount) / 10000).toFixed(2);
            results.push({
              age: age,
              years: actualYears,
              rate: (rate * 100).toFixed(0),
              totalInvestment: result.totalInvestment,
              finalAmount: finalAmountInWan,
              profit: result.profit,
              multiple: result.multiple
            });
            
            // æ ¹æ®æ”¶ç›Šå€æ•°è·å–åº•è‰²
            let backgroundColor = 'white';
            const multiple = parseFloat(result.multiple);
            if (multiple >= 10) {
              backgroundColor = '#d1fae5'; // æµ…ç»¿è‰²
            } else if (multiple >= 7) {
              backgroundColor = '#dbeafe'; // æµ…è“è‰²
            } else if (multiple >= 5) {
              backgroundColor = '#fef3c7'; // æµ…é»„è‰²
            } else if (multiple >= 3) {
              backgroundColor = '#fce7f3'; // æµ…ç²‰è‰²
            }
            
            // æ ¹æ®æ˜¾ç¤ºé€‰é¡¹æ·»åŠ ç›¸åº”çš„å•å…ƒæ ¼
            if (displayOption === 'finalAmount') {
              rowHtml += `
                <td style="padding: 0.75rem; text-align: right; border: 1px solid #ddd; font-weight: ${multiple > 5 ? 'bold' : 'normal'}; background-color: ${backgroundColor};">${finalAmountInWan}</td>
              `;
            } else {
              rowHtml += `
                <td style="padding: 0.75rem; text-align: right; border: 1px solid #ddd; font-weight: ${multiple > 5 ? 'bold' : 'normal'}; background-color: ${backgroundColor};">${result.multiple}x</td>
              `;
            }
          }
          
          row.innerHTML = rowHtml;
          fireTableBody.appendChild(row);
        }
        
        return results;
      }
      
      // æ¸²æŸ“æ”¶ç›Šå¯¹æ¯”å›¾è¡¨
      function renderFireChart(results) {
        const ctx = document.getElementById('fireChart').getContext('2d');
        
        // é”€æ¯æ—§å›¾è¡¨
        if (fireChart) {
          fireChart.destroy();
        }
        
        // è·å–ç”¨æˆ·é€‰æ‹©çš„æ˜¾ç¤ºé€‰é¡¹
        const displayOption = document.getElementById('displayOption').value;
        
        // æŒ‰å¹´é¾„åˆ†ç»„æ•°æ®
        const ages = [20, 30, 36];
        const rates = ['4%', '8%', '12%'];
        
        const datasets = [];
        
        // ä¸ºæ¯ä¸ªå¹´é¾„åˆ›å»ºä¸€ä¸ªæ•°æ®é›†
        const colors = ['rgba(75, 192, 192, 0.6)', 'rgba(54, 162, 235, 0.6)', 'rgba(255, 206, 86, 0.6)'];
        const borderColors = ['rgba(75, 192, 192, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)'];
        
        ages.forEach((age, index) => {
          const ageResults = results.filter(r => parseInt(r.age) === age);
          let chartData;
          
          if (displayOption === 'finalAmount') {
            chartData = ageResults.map(r => parseFloat(r.finalAmount));
          } else {
            chartData = ageResults.map(r => parseFloat(r.multiple));
          }
          
          datasets.push({
            label: `${age}å²å¼€å§‹æŠ•èµ„`,
            data: chartData,
            backgroundColor: colors[index],
            borderColor: borderColors[index],
            borderWidth: 2,
            tension: 0.1
          });
        });
        
        // è®¾ç½®å›¾è¡¨æ ‡é¢˜å’ŒYè½´æ ‡ç­¾
        let yAxisLabel = 'æœ€ç»ˆèµ„äº§ï¼ˆä¸‡å…ƒï¼‰';
        let chartTitle = 'ä¸åŒå¼€å§‹å¹´é¾„å’Œå¹´åŒ–æ”¶ç›Šç‡çš„æŠ•èµ„æ”¶ç›Šå¯¹æ¯”';
        
        if (displayOption === 'multiple') {
          yAxisLabel = 'æ”¶ç›Šå€æ•°';
          chartTitle = 'ä¸åŒå¼€å§‹å¹´é¾„å’Œå¹´åŒ–æ”¶ç›Šç‡çš„æ”¶ç›Šå€æ•°å¯¹æ¯”';
        }
        
        fireChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: rates,
            datasets: datasets
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: yAxisLabel
                }
              },
              x: {
                title: {
                  display: true,
                  text: 'å¹´åŒ–æ”¶ç›Šç‡'
                }
              }
            },
            plugins: {
              title: {
                display: true,
                text: chartTitle,
                font: {
                  size: 16
                }
              },
              legend: {
                position: 'top'
              }
            }
          }
        });
      }
      
      // ç”ŸæˆæŠ•èµ„æ´å¯Ÿ
      function generateInsight(results, monthlyAmount, years) {
        // æ‰¾åˆ°æœ€å¤§å’Œæœ€å°çš„æ”¶ç›Š
        const maxResult = results.reduce((max, current) => 
          parseFloat(current.finalAmount) > parseFloat(max.finalAmount) ? current : max
        );
        
        const minResult = results.reduce((min, current) => 
          parseFloat(current.finalAmount) < parseFloat(min.finalAmount) ? current : min
        );
        
        const difference = (parseFloat(maxResult.finalAmount) - parseFloat(minResult.finalAmount)).toFixed(2);
        const differencePercent = ((difference / parseFloat(minResult.finalAmount)) * 100).toFixed(0);
        
        let insight = `
          <strong>æŠ•èµ„å°½æ—©å¼€å§‹çš„é‡è¦æ€§ï¼š</strong><br><br>
          â€¢ ä»${maxResult.age}å²å¼€å§‹æŠ•èµ„ï¼ˆ${maxResult.years}å¹´ï¼‰ï¼Œå¹´åŒ–æ”¶ç›Šç‡${maxResult.rate}%ï¼Œæœ€ç»ˆèµ„äº§å¯è¾¾${maxResult.finalAmount}ä¸‡å…ƒ<br>
          â€¢ ä»${minResult.age}å²å¼€å§‹æŠ•èµ„ï¼ˆ${minResult.years}å¹´ï¼‰ï¼Œå¹´åŒ–æ”¶ç›Šç‡${minResult.rate}%ï¼Œæœ€ç»ˆèµ„äº§ä»…ä¸º${minResult.finalAmount}ä¸‡å…ƒ<br>
          â€¢ å·®è·é«˜è¾¾${difference}ä¸‡å…ƒï¼Œç›¸å½“äº${differencePercent}%<br><br>
          <strong>å…³é”®æ´å¯Ÿï¼š</strong><br>
          1. <strong>æ—¶é—´çš„åŠ›é‡</strong>ï¼šæ—©5å¹´å¼€å§‹æŠ•èµ„ï¼Œå³ä½¿å¹´åŒ–æ”¶ç›Šç‡ç›¸åŒï¼Œæœ€ç»ˆæ”¶ç›Šä¹Ÿä¼šæœ‰æ˜¾è‘—å·®å¼‚<br>
          2. <strong>å¤åˆ©çš„é­”åŠ›</strong>ï¼šå¹´åŒ–æ”¶ç›Šç‡ä»4%æå‡åˆ°12%ï¼Œæœ€ç»ˆæ”¶ç›Šå¯èƒ½ç›¸å·®æ•°å€<br>
          3. <strong>åšæŒçš„é‡è¦æ€§</strong>ï¼šæ¯æœˆå®šæŠ•${monthlyAmount}å…ƒï¼Œé•¿æœŸåšæŒä¼šç§¯ç´¯å¯è§‚çš„è´¢å¯Œ<br><br>
          ç»“è®ºï¼šæŠ•èµ„å°½æ—©å¼€å§‹ï¼Œé€‰æ‹©åˆé€‚çš„æŠ•èµ„ç­–ç•¥ï¼Œé•¿æœŸåšæŒï¼Œæ˜¯å®ç°è´¢åŠ¡è‡ªç”±çš„å…³é”®ã€‚
        `;
        
        insightText.innerHTML = insight;
      }
      
      // æ›´æ–°è¡¨æ ¼å¤´éƒ¨
      function updateTableHeader() {
        const displayOption = document.getElementById('displayOption').value;
        const headerRows = document.querySelectorAll('#fireTableHeader tr');
        const dataRow = headerRows[1];
        const dataCells = dataRow.querySelectorAll('th');
        
        // æ›´æ–°æ•°æ®è¡Œçš„æ ‡é¢˜
        const headerText = displayOption === 'finalAmount' ? 'æœ€ç»ˆèµ„äº§ï¼ˆä¸‡å…ƒï¼‰' : 'æ”¶ç›Šå€æ•°';
        
        for (let i = 1; i < dataCells.length; i++) {
          dataCells[i].textContent = headerText;
        }
      }
      
      // è®¡ç®—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      calculateFireBtn.addEventListener('click', function() {
        const monthlyAmount = parseFloat(monthlyInvestmentInput.value);
        const years = parseInt(investmentYearsInput.value);
        
        // æ›´æ–°è¡¨æ ¼å¤´éƒ¨
        updateTableHeader();
        
        // æ¸²æŸ“è¡¨æ ¼
        const results = renderFireTable(monthlyAmount, years);
        
        // æ¸²æŸ“å›¾è¡¨
        renderFireChart(results);
        
        // ç”ŸæˆæŠ•èµ„æ´å¯Ÿ
        generateInsight(results, monthlyAmount, years);
      });
      
      // æ˜¾ç¤ºé€‰é¡¹åˆ‡æ¢äº‹ä»¶
      document.getElementById('displayOption').addEventListener('change', function() {
        const monthlyAmount = parseFloat(monthlyInvestmentInput.value);
        const years = parseInt(investmentYearsInput.value);
        
        // æ›´æ–°è¡¨æ ¼å¤´éƒ¨
        updateTableHeader();
        
        // é‡æ–°æ¸²æŸ“è¡¨æ ¼
        const results = renderFireTable(monthlyAmount, years);
        
        // é‡æ–°æ¸²æŸ“å›¾è¡¨
        renderFireChart(results);
      });
    });
  </script>
</body>
</html>