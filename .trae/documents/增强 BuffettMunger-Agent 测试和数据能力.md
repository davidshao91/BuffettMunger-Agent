# 增强 BuffettMunger-Agent 测试和数据能力计划

## 一、当前项目现状分析

### 数据获取现状
- **示例数据**：使用内置的离线示例数据
- **实时数据**：使用新浪财经API，但大部分字段是模拟的
- **数据源单一**：仅支持新浪财经API

### 测试现状
- **测试文件少**：仅2个测试文件
- **测试覆盖有限**：主要测试核心分析逻辑
- **无API测试**：未测试新浪财经API的实际可用性

## 二、增强计划

### 1. 完善API测试
- **添加新浪财经API测试**：验证API调用的可用性和数据返回格式
- **测试网络异常处理**：确保网络错误时的优雅降级
- **测试数据解析**：验证API返回数据的正确解析

### 2. 扩展数据源
- **添加雪球网数据获取**：
  - 实现雪球网API调用
  - 解析雪球网的股票数据
  - 集成到现有数据加载流程

- **添加小红书数据获取**：
  - 实现小红书API调用
  - 提取相关的投资信息和市场情绪
  - 整合到分析模型中

### 3. 整合大模型评估
- **添加大模型接口**：
  - 支持主流LLM API（如OpenAI、Claude等）
  - 实现数据格式化和模型调用

- **增强分析能力**：
  - 利用大模型分析非结构化数据
  - 生成更全面的投资建议
  - 整合市场情绪分析

### 4. 完善测试体系
- **添加数据源测试**：
  - 测试各数据源的连接和数据获取
  - 测试数据格式的一致性

- **添加集成测试**：
  - 测试完整的数据获取和分析流程
  - 测试不同数据源的切换

- **添加大模型测试**：
  - 测试大模型API调用
  - 测试模型返回结果的处理

## 三、技术实现要点

### 数据模块增强
- 重构 `data.py`，支持多数据源配置
- 实现数据源抽象层，便于扩展新的数据源
- 添加数据缓存机制，减少API调用频率

### 大模型集成
- 创建 `llm.py` 模块，处理大模型调用
- 设计提示词模板，确保模型返回结构化数据
- 实现模型结果的解析和整合

### 测试模块完善
- 创建 `tests/test_data.py`，测试数据获取功能
- 创建 `tests/test_llm.py`，测试大模型集成
- 创建 `tests/test_integration.py`，测试完整流程

## 四、预期收益

1. **数据可靠性提升**：多数据源验证，确保数据准确性
2. **分析深度增强**：结合大模型，提供更全面的分析
3. **测试覆盖率提高**：完善的测试体系，确保系统稳定性
4. **扩展性增强**：模块化设计，便于添加新的数据源和分析能力

## 五、实施步骤

1. **第一步**：完善API测试，验证现有新浪财经API的可用性
2. **第二步**：扩展数据源，添加雪球网和小红书数据获取
3. **第三步**：整合大模型评估能力
4. **第四步**：完善测试体系，确保所有功能正常工作
5. **第五步**：更新文档和使用指南

通过这些增强，BuffettMunger-Agent 将具备更强大的数据获取能力和分析深度，为用户提供更准确、全面的投资分析服务。